<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>面试复盘 - 编程浪子</title><meta name="Description" content="记录社招面试过程及复盘"><meta property="og:title" content="面试复盘" />
<meta property="og:description" content="记录社招面试过程及复盘" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bardblog.cn/interview/" /><meta property="og:image" content="https://www.bardblog.cn/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-01T08:59:43+08:00" />
<meta property="article:modified_time" content="2023-07-01T08:59:43+08:00" /><meta property="og:site_name" content="编程浪子" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.bardblog.cn/logo.png"/>

<meta name="twitter:title" content="面试复盘"/>
<meta name="twitter:description" content="记录社招面试过程及复盘"/>
<meta name="application-name" content="Bard">
<meta name="apple-mobile-web-app-title" content="Bard"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.bardblog.cn/interview/" /><link rel="prev" href="https://www.bardblog.cn/git-advanced-usage/" /><link rel="next" href="https://www.bardblog.cn/mysql-core-concepts/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "面试复盘",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.bardblog.cn\/interview\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/www.bardblog.cn\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "MySQL, InnoDB, Redis, Kafka, Algorithm","wordcount":  17315 ,
        "url": "https:\/\/www.bardblog.cn\/interview\/","datePublished": "2023-07-01T08:59:43+08:00","dateModified": "2023-07-01T08:59:43+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.bardblog.cn\/images\/avatar.gif",
                    "width":  700 ,
                    "height":  700 
                }},"author": {
                "@type": "Person",
                "name": "Bard"
            },"description": "记录社招面试过程及复盘"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="编程浪子"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/YourFantasy/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="选择语言">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/interview/" selected>简体中文</option><option value="/en/interview/">English</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="编程浪子"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/YourFantasy/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/interview/" selected>简体中文</option><option value="/en/interview/">English</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">面试复盘</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="www.bardblog.cn" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Bard</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/technology/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>technology</a>&nbsp;<a href="/categories/interview/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>interview</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-07-01">2023-07-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 17315 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 35 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#底层存储设计">底层存储设计</a>
      <ul>
        <li><a href="#数据结构">数据结构</a></li>
        <li><a href="#背景">背景</a>
          <ul>
            <li><a href="#redis底层设计">redis底层设计</a></li>
            <li><a href="#在redis之上构建的本地缓存">在redis之上构建的本地缓存</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#私密子频道鉴权模型优化">私密子频道鉴权模型优化</a>
      <ul>
        <li><a href="#背景-1">背景</a></li>
        <li><a href="#优化">优化</a></li>
      </ul>
    </li>
    <li><a href="#事件中心拉平">事件中心拉平</a>
      <ul>
        <li><a href="#背景-2">背景</a></li>
        <li><a href="#优化-1">优化</a>
          <ul>
            <li><a href="#削峰拉平">削峰拉平</a></li>
            <li><a href="#非关键信息增量推送">非关键信息增量推送</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#id转换服务重写">ID转换服务重写</a>
      <ul>
        <li><a href="#背景-3">背景</a></li>
        <li><a href="#现状">现状</a></li>
        <li><a href="#优化-2">优化</a></li>
      </ul>
    </li>
    <li><a href="#大群通道">大群通道</a></li>
    <li><a href="#微服务治理">微服务治理</a>
      <ul>
        <li><a href="#背景-4">背景</a></li>
        <li><a href="#治理">治理</a></li>
      </ul>
    </li>
    <li><a href="#其它">其它</a></li>
  </ul>

  <ul>
    <li><a href="#微派挂">微派（挂）</a>
      <ul>
        <li><a href="#20230707-微派一面挂">20230707 微派一面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#美团offer">美团（offer)</a>
      <ul>
        <li><a href="#20230711-美团一面过">20230711 美团一面（过）</a></li>
        <li><a href="#20230719-美团二面过">20230719 美团二面（过）</a></li>
      </ul>
    </li>
    <li><a href="#拼多多offer">拼多多(offer)</a>
      <ul>
        <li><a href="#20230711-拼多多一面过">20230711 拼多多一面（过）</a></li>
        <li><a href="#20230716-拼多多二面过">20230716 拼多多二面（过）</a></li>
        <li><a href="#20230723-拼多多三面过">20230723 拼多多三面（过）</a></li>
      </ul>
    </li>
    <li><a href="#最右">最右</a>
      <ul>
        <li><a href="#20230712-最右一面挂">20230712 最右一面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#百度">百度</a>
      <ul>
        <li><a href="#20230713-百度一面过">20230713 百度一面（过）</a></li>
        <li><a href="#20230720-百度二面过">20230720 百度二面（过）</a></li>
      </ul>
    </li>
    <li><a href="#迅雷">迅雷</a>
      <ul>
        <li><a href="#20230714-迅雷一面过">20230714 迅雷一面（过）</a></li>
        <li><a href="#20230718-迅雷二面挂">20230718 迅雷二面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#滴滴">滴滴</a>
      <ul>
        <li><a href="#20230715-滴滴一面过">20230715 滴滴一面（过）</a></li>
        <li><a href="#20230715-滴滴二面挂">20230715 滴滴二面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#莉莉丝">莉莉丝</a>
      <ul>
        <li><a href="#20230721-莉莉丝一面过">20230721 莉莉丝一面（过）</a></li>
      </ul>
    </li>
    <li><a href="#小红书hr挂">小红书（HR挂）</a>
      <ul>
        <li><a href="#20230727-小红书一面过">20230727 小红书一面（过）</a></li>
        <li><a href="#20230801-小红书二面过">20230801 小红书二面（过）</a></li>
        <li><a href="#29230808-小红书三面过">29230808 小红书三面（过）</a></li>
      </ul>
    </li>
    <li><a href="#米哈游">米哈游</a>
      <ul>
        <li><a href="#20230801-米哈游一面过">20230801 米哈游一面（过）</a></li>
        <li><a href="#20230808-米哈游二面挂">20230808 米哈游二面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#b站">B站</a>
      <ul>
        <li><a href="#20230802-b站一面过">20230802 B站一面（过）</a></li>
        <li><a href="#20230804-b站二面过">20230804 B站二面（过）</a></li>
        <li><a href="#20230809-b站三面过">20230809 B站三面（过）</a></li>
      </ul>
    </li>
    <li><a href="#鹰角">鹰角</a>
      <ul>
        <li><a href="#20230804-鹰角一面挂">20230804 鹰角一面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#蚂蚁金服">蚂蚁金服</a>
      <ul>
        <li><a href="#20230814-蚂蚁金服一面挂">20230814 蚂蚁金服一面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#字节跳动">字节跳动</a>
      <ul>
        <li><a href="#20230821-字节跳动一面挂">20230821 字节跳动一面（挂）</a></li>
      </ul>
    </li>
    <li><a href="#百度-1">百度</a>
      <ul>
        <li><a href="#20230824-百度一面">20230824 百度一面</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="项目总结">项目总结</h1>
<h2 id="底层存储设计">底层存储设计</h2>
<h3 id="数据结构">数据结构</h3>
<p>所有的关系链数据都是使用redis的hash数据结构来存储的，设计了一个通用的适配层，高性能、安全、多租户的通用存储系统。</p>
<h3 id="背景">背景</h3>
<ul>
<li>从qq群历史架构-&gt;discord-&gt;需要支持千万级关系链的读写能力,，关系链复杂，超大群，热点效应。通用、高并发、安全、百万人量级关系链系统。</li>
<li>构建一个存储适配层，read和write。write会聚合排队写</li>
</ul>
<h4 id="redis底层设计">redis底层设计</h4>
<ul>
<li>首先介绍一下业务背景，几个核心的关系链场景基本概念，解释为啥要使用redis作为db使用，然后解释说明为啥要用redis的hash这种数据结构，排除法来选择。以频道下的人这个关系链存储来展开，再引申到key和热 key 问题怎么解决？</li>
<li>以频道ID作为key，filed是成员id，filed对应的value是成员基本信息，入昵称、角色等业务信息，是pb序列化后的结果。</li>
<li>频道初始化的时候有两个hash结构的key，一个称之为member，一个称之为info，member很大，info很小，存储频道业务和元数据路由信息。每个member表分配beginIndex,endIndex。</li>
<li>拆表/合并策略：类似于二叉树的结点分裂，每次一分为二，计算qq号的hash值，分配到左区间还是右区间，并更新路由信息，大概耗时90多ms；如果发现某个子表的数量很小，尝试和它的另一半合并，并更新路由信息，大概耗时40ms。</li>
<li>版本号控制，全局有一个版本号，每个子表也有一个版本号；控制当前的版本，版本号是递增的，初始化的时候是0，每次数据更新或者分裂都会更新版本号。</li>
<li>支持多租户，上述只是以频道下这个人作为例子，实际上我们的这套存储设计抽象是跟业务无关的，抽象，支持多租户0成本接入。</li>
</ul>
<h4 id="在redis之上构建的本地缓存">在redis之上构建的本地缓存</h4>
<ul>
<li>
<p>缓存子表，没台机器存储全量大频道数据，目前占用8G左右，三大策略保证一致性；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.广播更新（内网，增量）；2后台定时轮询子表版本号，版本号落后，更新数据（全量）；3；缓存命中抽样上报，低于阈值触发熔断（降级熔断）。
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>排队合并写入，对于加频道/退频道请求，会本地排队聚合写入，减少广播次数。请求合并.</p>
</li>
<li>
<p>容器化部署，自动伸缩,128GB*24=3TB内存， 内存使用率54%，cpu使用率50%，写tps 3000多，平均每台机器100多写入请求</p>
</li>
<li>
<p>同时缓存Info和子表数据，精细化构建缓存和更新，减少缓存失效次数。使用合并策略，一致性hash算法路由到一台机器从redis拉取数据构建更新缓存，减少拉取流量和热key问题。写操作读取不走缓存，直接穿透db。</p>
</li>
</ul>
<h2 id="私密子频道鉴权模型优化">私密子频道鉴权模型优化</h2>
<h3 id="背景-1">背景</h3>
<p>历史原因导致私密子频道鉴权会扩散查私密子频道成员，当私密子频道活动比较多的时候（触发大量读鉴权），叠加多个写操作。会对底层产生较大压力，触发告警。热key问题。优化 <code>人-频道</code>、<code>人-子频道</code>、<code>人-身份组</code>、<code>子频道-身份组</code>，人的身份组和子频道身份组取交。</p>
<h3 id="优化">优化</h3>
<ul>
<li>优化人的子频道这个存储，将反向关系链做准，以反向关系链鉴权人在不在频道，热点问题变成散列问题。</li>
<li>存储模型优化：历史原因导致，鉴权模型私密子频道+身份组+私密子频道下的人+身份组下的人，干掉私密子频道下的人，把私密子频道也理解为一个隐藏身份组，梳理上下游服务，读写改造灰度、历史数据迁移，发布节奏控制，风险把控</li>
<li>基于关系链存储构建二级cache缓存：梳理业务，细化人和子频道纬度，哪些地方写会影响缓存，子频道-身份组（本地）和人-身份组（redis）纬度的缓存。细化写逻辑。热点问题变成散列问题</li>
</ul>
<h2 id="事件中心拉平">事件中心拉平</h2>
<h3 id="背景-2">背景</h3>
<p>王者荣耀等超大频道运营活动导致一下子感知到很多人，推送信令触发拉取操作，千人千面对后台关系链产生较大压力。</p>
<h3 id="优化-1">优化</h3>
<h4 id="削峰拉平">削峰拉平</h4>
<ul>
<li>redis实现延迟队列削峰拉平</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">score</span> <span class="o">=</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZSCORE&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="kr">if</span> <span class="p">(</span><span class="n">score</span> <span class="o">==</span> <span class="kc">false</span> <span class="ow">or</span> <span class="n">score</span> <span class="o">%%</span> <span class="o">%</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kr">then</span>
</span></span><span class="line"><span class="cl">		<span class="n">score</span> <span class="o">=</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZADD&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="kr">end</span>
</span></span><span class="line"><span class="cl">	<span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZADD&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">score</span><span class="p">,</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="kr">return</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXPIRE&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="err">`</span>
</span></span><span class="line"><span class="cl"><span class="o">#</span> <span class="err">三类</span><span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.</span><span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">：</span><span class="n">taskKey</span><span class="err">（</span><span class="n">zset</span><span class="p">):</span><span class="err">单个，任务集合</span>
</span></span><span class="line"><span class="cl"><span class="n">score</span><span class="err">：当前时间戳</span>
</span></span><span class="line"><span class="cl"><span class="n">member</span><span class="p">:</span><span class="n">guild_id</span><span class="o">+</span><span class="n">even_type</span><span class="o">+</span><span class="n">ip</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">2.</span><span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">eventKeys</span><span class="p">(</span><span class="n">zset</span><span class="p">):</span><span class="err">多个，具体的事件</span><span class="p">,</span><span class="err">和</span><span class="n">taskKey中的member对应</span>
</span></span><span class="line"><span class="cl"><span class="n">score</span><span class="p">:</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">中的时间戳</span>
</span></span><span class="line"><span class="cl"><span class="n">member</span><span class="p">:</span><span class="err">事件的内容序列化后的内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">3.</span><span class="n">last_consumer_score</span><span class="p">:</span> <span class="err">单个，每次从</span><span class="n">taskKey取任务之前拉取</span><span class="err">，消费完成后设置。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>每300ms从taskKey取任务，再从eventKeys中取任务，根据事件类型进行合并分包写到一个下游kafka，5000个人一个包。每次执行完任务后更新last_consumer_score</li>
<li>兜底逻辑：考虑到服务宕机等问题，可能某台机器写到taskKey的任务没来得及消费，这个时候需要另外一个线程执行兜底逻辑消费未被消费的任务，会使用分布式锁上锁，防止多台机器重复消费。</li>
<li>下游服务消费写入的kafka执行推送任务，复用大群通道推送，限流控速。</li>
</ul>
<h4 id="非关键信息增量推送">非关键信息增量推送</h4>
<p>对于频道名称或者其它不是很关键的信息，直接走增量推送，把数据直接推给客户端，不用触发拉取。 推失败也没关系客户度会有补偿逻辑。</p>
<h2 id="id转换服务重写">ID转换服务重写</h2>
<h3 id="背景-3">背景</h3>
<p>底层id转换服务，请求量大上游多，数据量key超多，对服务稳定性以及耗时有严苛要求。</p>
<h3 id="现状">现状</h3>
<ul>
<li>单机缓存构建耗时过长，10分钟后机器才能提供服务，且随着id数增长，耗时会越来越大。</li>
<li>bigcache占用空间过大（bigcache空间占用由map+对象序列化后内存消耗组成），线上30GB内存最多存储2亿数据。</li>
<li>服务中大量使用int转string、pb打解包等方法，以及不合理的打点，影响整体性能。</li>
</ul>
<h3 id="优化-2">优化</h3>
<ul>
<li>
<p>使用自己实现的cache代替原来的bigcache，一亿个键值对，1亿数据占用不到1.7GB，64GB机器可支撑30亿正反数据（15亿账号）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.本地cache 使用三个数组实现，单条kv数据是8（key<span class="o">)</span>+8<span class="o">(</span>val<span class="o">)</span>+1<span class="o">(</span>时间）<span class="o">=</span>17个字节，节省空间，内存更紧凑，相比于map空洞更少
</span></span><span class="line"><span class="cl">2.分片设计，根据hash算法把key hash到不同分片,降低锁粒度，目前是3w个分片，每个分片3000多条数据。
</span></span><span class="line"><span class="cl">3.读取使用二分查找的方式查找数据，单分片单次查找速度极快33ns，内置map是20ns，bigcache是109ns。
</span></span><span class="line"><span class="cl">4.基本数据类型，省去序列化反序列化过程，直存直取。后台任务定时扫描清理老数据，腾出空间
</span></span><span class="line"><span class="cl">5.使用插入排序的方式更新数据，基本有序数据插入排序时间复杂度很快<span class="p">;</span>触发容量上限会删除最老的数据，没有触发的话会按照步长扩容。
</span></span><span class="line"><span class="cl">6.使用cos作为持久化数据（加密+压缩，压缩率60%）每天随机一台机器定时dump一次数据到56个cos小文件，每个文件都有hash校验和。
</span></span><span class="line"><span class="cl">7.服务启动并发拉取cos数据还原加载本地内存数据，根据hash校验和剔除掉有问题文件，4s内恢复。
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="大群通道">大群通道</h2>
<ul>
<li>以人纬度的缓存，增量+全量更新逻辑，用户消息驱动+kafka增量更新消息空洞补齐+后台定时扫描全量更新，保证数据一致性</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">cache1</span><span class="p">:</span>	<span class="nx">key</span><span class="err">：</span><span class="nx">guild_id</span><span class="o">+</span><span class="nx">sub_id</span><span class="p">:</span><span class="nx">value</span> <span class="mi">5000</span><span class="nx">个子表</span> <span class="c1">// 每个频道每个子表的全量数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">cache2</span><span class="p">:</span>	<span class="nx">key</span><span class="p">:</span><span class="nx">guild_id</span><span class="o">+</span><span class="nx">uin</span><span class="p">:</span><span class="nx">value</span><span class="err">：</span><span class="nx">人的信息</span> <span class="c1">// 缓存人在频道里面的信息，主要是权限数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">cach3</span><span class="p">:</span>	<span class="nx">key</span><span class="p">:</span><span class="nx">uin</span><span class="p">:</span><span class="nx">value</span><span class="p">:</span><span class="kd">map</span><span class="p">[</span><span class="nx">guild_id</span><span class="p">][</span><span class="nx">sub_id</span><span class="p">]</span>  <span class="c1">//人在每个频道所属的子表信息
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>消息以人为纬度聚合推送（减少下行流量）+消息精简+消息分级，高优先级先推，低优先级后推。减少推送次数+减少推送流量。</li>
<li>消息精简，焦点上报，客户端维护一份焦点，在推送消息的时候把人的焦点信息也推送下去，客户端判断焦点和自己本地较低是否一致，不一致则上报焦点，一致则不上报，避免无效频繁上报。</li>
<li>token机制，atall的时候，使用token鉴权，减少拉取消息对于关系链的请求压力。构建以人纬度的缓存，做增量和全量更新。</li>
</ul>
<h2 id="微服务治理">微服务治理</h2>
<h3 id="背景-4">背景</h3>
<p>目前4个后台组总共有600个微服务，对于底层的核心服务存在很多不合理调用情况，微服务拆分过细，接口设计不合理等问题。继续优化改造，降低风险。主要以下几个手段</p>
<h3 id="治理">治理</h3>
<ul>
<li>大流量底层服务推动微服务治理，抓大放小，减少重复调用，推动上下游改造。把控进度和风险。</li>
<li>对于大而全的接口，拆分细化，提供轻量级的接口，逐步平滑迁移。</li>
<li>微服务合并，将功能/代码类似的微服务合并到一个服务，减少微服务数量和链路复杂性，节省机器资源。</li>
<li>核心大流量服务申请调用需要走申请，需要详细说明调用目的以及调用频率，管控混乱调用，</li>
<li>设计不合理代码性能优化，重构，池化技术、缓存、请求合并。</li>
<li>推动上游服务请求合并&amp;增加缓存，优化性能节省机器资源。</li>
</ul>
<h2 id="其它">其它</h2>
<ul>
<li>架构合理：底层存储选型是否合理，数据结构/表设计是否合理，数据/扩散比模型推演,分库分表，存储拆分。</li>
<li>横向/纵向扩容：系统具有较好的扩展能力，留足buffer，自动扩缩容，减少人工介入。</li>
<li>池化技术：代码层面使用池化技术，包括连接池/协程池/对象池，复用思想。</li>
<li>gc调优；gc压力过大，需要分析优化，减少内存碎片，减少gc频率，减少gc次数。</li>
<li>锁优化，减少锁粒度，分片锁而不是全局锁，读写锁而不是互斥锁，乐观锁而不是悲观锁。</li>
<li>缓存：缓存预热，饿加载方式，同时尽量保证缓存一致性保，多级缓存。</li>
<li>全链路监控告警：包括pass、拨测、服务指标、打点监控等全链路无死角告警。监控要求全面且准确，并且针对告警有应对预案。</li>
<li>并发/异步：代码层面能够并发的并发，能够异步的异步，使用mq等方式解耦。</li>
<li>链路优化/精简，微服务架构优化，轻量级接口，减少无效请求和调用，请求聚合，减少重复请求。</li>
<li>限流/降级策略，非核心场景降级开关，避免阻塞主流程，保证主场景可用。</li>
<li>接口重试/幂等：失败重试，但是要注意重试雪崩，保证接口幂等，对冲重试。</li>
<li>服务全链路压测：事前压测，事前分析系统短板，事前优化。</li>
<li>削峰/限流策略：峰值流量削峰限流，限流防止打垮db，有损减少核心场景不可用。</li>
<li>服务发布，ci/cd，观测指标，灰度发布，关键日志、监控打点，紧急回滚策略。</li>
<li>容灾：同地多机房，异地部署，防止全死全活。</li>
<li>服务接口数据自修复能力，系统健壮性。数据压缩，cpu和io权衡。</li>
<li>降低系统耦合度，接口单一职责，接口拆分。避免大而全接口，微服务改造。</li>
</ul>
<h1 id="面试复盘">面试复盘</h1>
<h2 id="微派挂">微派（挂）</h2>
<h3 id="20230707-微派一面挂">20230707 微派一面（挂）</h3>
<ul>
<li>bitmap数据结构底层实现，最大2^32个bit位。占用内存空间位512MB（8位占用1B）</li>
</ul>
<p>$$
2^{32}bit=2^{10} \times 2^{10} \times 2^{10} \times 2^{3} \div 2 =1GB \div2=512MB
$$</p>
<p><strong>以下是用go语言实现的位图：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">outOfRange</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;out of range&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">BitMap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">bits</span> <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="nx">size</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// NewBitMap 创建一个bitmap
</span></span></span><span class="line"><span class="cl"><span class="c1">// size bitmap能存储最大的位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewBitMap</span><span class="p">(</span><span class="nx">size</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">BitMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">BitMap</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">bits</span><span class="p">:</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="p">(</span><span class="nx">size</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">),</span> <span class="c1">// 向上取整
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">size</span><span class="p">:</span> <span class="nx">size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// SetBit 设置指定位的bit值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">BitMap</span><span class="p">)</span> <span class="nf">SetBit</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">val</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">index</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">outOfRange</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">byteIndex</span> <span class="o">:=</span> <span class="nx">index</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">	<span class="nx">bitIndex</span> <span class="o">:=</span> <span class="nx">index</span> <span class="o">%</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">val</span> <span class="p">{</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">[</span><span class="nx">byteIndex</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="nx">bitIndex</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">[</span><span class="nx">byteIndex</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="p">^(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="nx">bitIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GetBit 获取位图指定位置是否是1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">BitMap</span><span class="p">)</span> <span class="nf">GetBit</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">index</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">outOfRange</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">byteIndex</span> <span class="o">:=</span> <span class="nx">index</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">	<span class="nx">bitIndex</span> <span class="o">:=</span> <span class="nx">index</span> <span class="o">%</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">[</span><span class="nx">byteIndex</span><span class="p">]</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">bitIndex</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// CountRange 获取位图中指定范围内的位的数量，返回的是该范围内值为1的位的数量。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">BitMap</span><span class="p">)</span> <span class="nf">CountRange</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">begin</span> <span class="p">&gt;</span> <span class="nx">end</span> <span class="o">||</span> <span class="nx">begin</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">end</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">bits</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">outOfRange</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cnt</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">begin</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">b</span><span class="p">.</span><span class="nf">GetBit</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="nx">res</span> <span class="p">{</span> <span class="c1">// 入口处已经检查参数判断，所以这里不用判断了，可以忽略error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">cnt</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">cnt</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// CountAll 统计整个位图中值为1的位的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">BitMap</span><span class="p">)</span> <span class="nf">CountAll</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">b</span><span class="p">.</span><span class="nf">CountRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>从0～n-1这n个数中随机选择m个数，m&lt;=n，要求概率相等，选中的数不能重复</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// m&lt;=n;从0~n-1这个n个数中随机选出m个数，要求等概率，并且选出的m个数不能重复
</span></span></span><span class="line"><span class="cl"><span class="c1">// 蓄水池算法，数学归纳法证明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getMRandomDigits</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">m</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rand</span><span class="p">.</span><span class="nf">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">j</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nx">m</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>redis怎么减少内存占用空间？</li>
</ul>
<blockquote>
<ol>
<li>选用合适的数据结构来存储，比如可以用bitmap来表示大量唯一值，HyperLogLog统计唯一元素值的数量（基于数学概率，有一定误差，适用于海量数据统计）。</li>
<li>使用内存淘汰策略，淘汰长期不使用的键。</li>
<li>将同类型的元素聚合在Hash中，而不是作为键单独存储，减少键值本身的消耗，节省内存空间。</li>
<li>优化键名，防止键名过长。</li>
<li>使用LZF压缩，开启压缩，压缩和解压是在redis完成的，用户无感知。</li>
</ol>
</blockquote>
<h2 id="美团offer">美团（offer)</h2>
<h3 id="20230711-美团一面过">20230711 美团一面（过）</h3>
<ul>
<li>redis底层数据结构理解及原理了解?</li>
<li>知识的广度及深度需要提高?</li>
<li>发布如何从技术层面保证不出问题？</li>
</ul>
<p><strong>买卖股票的最佳时机：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="nx">prices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">prices</span><span class="p">)&lt;</span><span class="mi">2</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">buyPrice</span><span class="o">:=</span><span class="nx">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span><span class="o">:=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">prices</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">prices</span><span class="p">[</span><span class="nx">i</span><span class="p">]&lt;</span><span class="nx">buyPrice</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="nx">buyPrice</span><span class="p">=</span><span class="nx">prices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">res</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">prices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">-</span><span class="nx">buyPrice</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> 
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">max</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span><span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">a</span><span class="p">&lt;</span><span class="nx">b</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="20230719-美团二面过">20230719 美团二面（过）</h3>
<p>聊项目：纯聊项目，聊了140分钟&hellip;..</p>
<h2 id="拼多多offer">拼多多(offer)</h2>
<h3 id="20230711-拼多多一面过">20230711 拼多多一面（过）</h3>
<p>聊项目，30min</p>
<ul>
<li>场景设计题：如何拉取频道成员，按照加入时间排序？zset</li>
<li>除了hash，为啥不用其他的数据结构？</li>
<li>找到附近的人，怎么做？用什么redis 数据结构？Geo</li>
<li>对于redis的广度理解不够</li>
<li>函数延迟调用？</li>
</ul>
<p><strong>一个整数数组，除了一个数，其他数都出现了两次，找出这个只出现一次的数：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">findUniqueNum</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="o">:=</span><span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">^=</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="20230716-拼多多二面过">20230716 拼多多二面（过）</h3>
<ul>
<li>万人大群抢红包怎么处理？读扩散+写扩散模式</li>
<li>kafka为什么快?</li>
</ul>
<blockquote>
<p>Kafka 是一个高性能、可扩展的分布式消息队列系统，它之所以能够实现高吞吐量和低延迟，主要归功于以下几个设计原则和优化策略：</p>
<ol>
<li>高效的磁盘存储和顺序读写：Kafka 将消息存储在磁盘上，并利用操作系统的 page cache 进行缓存。Kafka 的消息存储是顺序的，这意味着它可以充分利用磁盘的顺序读写性能。顺序读写比随机读写更快，因为磁盘的寻道时间得到了显著减少。</li>
<li>零拷贝技术：Kafka 使用了零拷贝技术（zero-copy）来减少数据在内核空间和用户空间之间的拷贝次数。这可以降低 CPU 使用率，减少上下文切换，从而提高性能。</li>
<li>批量处理：Kafka 支持批量发送和消费消息。生产者可以将多个消息打包成一个批次，一次性发送给 Kafka。同样，消费者也可以一次性从 Kafka 获取多个消息。批量处理可以减少网络开销和磁盘 I/O，从而提高吞吐量。</li>
<li>分区和多副本：Kafka 的主题可以分为多个分区，每个分区可以独立地存储和处理消息。这使得 Kafka 可以在多个服务器上并行处理消息，从而实现水平扩展。此外，Kafka 还支持多副本，可以提高数据的可靠性和可用性。</li>
<li>消息压缩：Kafka 支持对消息进行压缩，以减少网络传输和磁盘存储的开销。压缩可以降低 I/O 压力，提高吞吐量。</li>
<li>消费者组和消费者位移：Kafka 使用消费者组和消费者位移来实现高效的消息消费。消费者组可以实现负载均衡，多个消费者可以共同消费一个主题。消费者位移记录了消费者在每个分区中消费的位置，这使得消费者可以随时恢复消费进度，而无需查询 Kafka。</li>
<li>异步处理：Kafka 的生产者和消费者都支持异步处理。生产者可以在不等待服务器响应的情况下发送消息，消费者可以在不等待处理完成的情况下获取消息。异步处理可以降低延迟，提高吞吐量。</li>
</ol>
<p>综上所述，Kafka 通过高效的磁盘存储、零拷贝技术、批量处理、分区和多副本、消息压缩、消费者组和消费者位移以及异步处理等设计原则和优化策略，实现了高吞吐量和低延迟的消息传输。</p>
</blockquote>
<ul>
<li>redis为什么这么快？</li>
</ul>
<blockquote>
<p>Redis 是一个高性能的键值存储系统，它之所以能够实现高速读写，主要归功于以下几个设计原则和优化策略：</p>
<ol>
<li>内存存储：Redis 将所有数据存储在内存中，这意味着它可以避免磁盘 I/O 带来的性能开销。内存访问速度远远快于磁盘，因此 Redis 能够实现高速读写。</li>
<li>单线程模型：Redis 使用单线程模型处理客户端请求，这意味着它不需要处理多线程之间的同步和锁竞争问题。单线程模型简化了 Redis 的设计，降低了上下文切换和锁竞争带来的性能开销。</li>
<li>高效的数据结构：Redis 支持多种高效的数据结构，如字符串、列表、集合、哈希表和有序集合。这些数据结构在内存中的表示非常紧凑，且支持高效的操作。例如，Redis 的哈希表实现了自动扩容和收缩，以保持高效的内存使用和性能。</li>
<li>事件驱动模型：Redis 使用事件驱动模型处理网络 I/O，这使得它可以高效地处理大量并发连接。事件驱动模型避免了线程阻塞和上下文切换带来的性能开销。</li>
<li>管道化（Pipelining）：Redis 支持管道化，这意味着客户端可以一次性发送多个命令，而无需等待每个命令的响应。管道化可以降低网络延迟，提高吞吐量。</li>
<li>优化的内存管理：Redis 使用自定义的内存管理器和内存分配器，以减少内存碎片和提高内存使用效率。此外，Redis 还支持内存回收策略，如 LRU（最近最少使用）算法，以在内存不足时自动删除不常用的数据。</li>
<li>持久化策略：虽然 Redis 主要是内存存储，但它也支持持久化策略，如 RDB 快照和 AOF 日志。这些持久化策略可以在后台异步执行，以减少对性能的影响。</li>
</ol>
<p>综上所述，Redis 通过内存存储、单线程模型、高效的数据结构、事件驱动模型、管道化、优化的内存管理和持久化策略等设计原则和优化策略，实现了高速读写。然而，这些优势也带来了一些限制，如内存容量限制和单线程处理能力限制。在实际应用中，需要根据具体需求权衡 Redis 的优势和限制</p>
</blockquote>
<ul>
<li>基于redis协议实现hbase协议？代理</li>
<li>写一个100%死锁的代码</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">deadLock</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span class="line"><span class="cl"><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">ch1</span><span class="p">,</span><span class="nx">ch2</span><span class="o">:=</span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl"> <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="o">&lt;-</span><span class="nx">ch1</span>
</span></span><span class="line"><span class="cl"> <span class="nx">ch2</span><span class="o">&lt;-</span><span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl"> <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="o">&lt;-</span><span class="nx">ch2</span>
</span></span><span class="line"><span class="cl"> <span class="nx">ch1</span><span class="o">&lt;-</span><span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}()</span>
</span></span><span class="line"><span class="cl"><span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="20230723-拼多多三面过">20230723 拼多多三面（过）</h3>
<ul>
<li>聊项目，难点</li>
<li>为什么来上海，996扛得住吗？在腾讯目前看起来很好，时日尚短为啥跳槽</li>
<li>给定一个长度为n的数组nums，求前k（1&lt;=k&lt;=n）个元素的中位数，如果k是偶数，取中间两个数的平均数四舍五入，输出是一个长度为n的数组，result[k-1]代表nums前k个元素的中位数</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 时间复杂度：O(n^2*logn)
</span></span></span><span class="line"><span class="cl"><span class="c1">// 空间复杂度：O(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getMid1</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tmp</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span> <span class="nx">j</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">tmp</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sort</span><span class="p">.</span><span class="nf">Ints</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">sum</span> <span class="o">:=</span> <span class="nx">tmp</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">tmp</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="nx">mid</span> <span class="o">:=</span> <span class="nx">sum</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">sum</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">mid</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">mid</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 时间复杂度：O(n^2)
</span></span></span><span class="line"><span class="cl"><span class="c1">// 空间复杂度：O(1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getMid2</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">index</span> <span class="o">:=</span> <span class="nf">findBigger</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">tmp</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">j</span> <span class="p">&gt;</span> <span class="nx">index</span><span class="p">;</span> <span class="nx">j</span><span class="o">--</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">nums</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">nums</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">=</span> <span class="nx">tmp</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">sum</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="nx">mid</span> <span class="o">:=</span> <span class="nx">sum</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">sum</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">mid</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">mid</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 时间复杂度：O(log(n!)趋近于O(nlogn)
</span></span></span><span class="line"><span class="cl"><span class="c1">// 空间复杂度：O(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getMid3</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">minH</span><span class="p">,</span> <span class="nx">maxH</span> <span class="o">:=</span> <span class="nf">newMinHeap</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)),</span> <span class="nf">newMaxHeap</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">minH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">maxH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">minH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">maxH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span> <span class="p">&gt;</span> <span class="nx">minH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">tmp</span> <span class="o">:=</span> <span class="nx">maxH</span><span class="p">.</span><span class="nf">Pop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="nx">maxH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">minH</span><span class="p">.</span><span class="nf">Pop</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="nx">minH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">maxH</span><span class="p">.</span><span class="nx">num</span> <span class="p">&gt;</span> <span class="nx">minH</span><span class="p">.</span><span class="nx">num</span><span class="o">+</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">minH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">maxH</span><span class="p">.</span><span class="nf">Pop</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">maxH</span><span class="p">.</span><span class="nx">num</span> <span class="p">&lt;</span> <span class="nx">minH</span><span class="p">.</span><span class="nx">num</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">maxH</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">minH</span><span class="p">.</span><span class="nf">Pop</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">sum</span> <span class="o">:=</span> <span class="nx">maxH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span> <span class="o">+</span> <span class="nx">minH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">sum</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">maxH</span><span class="p">.</span><span class="nf">Peek</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">findBigger</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">target</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">j</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span> <span class="o">:=</span> <span class="nx">i</span> <span class="o">+</span> <span class="p">(</span><span class="nx">j</span><span class="o">-</span><span class="nx">i</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">m</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span> <span class="p">=</span> <span class="nx">m</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">i</span> <span class="p">=</span> <span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">minHeap</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">val</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span><span class="p">]</span> <span class="p">=</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nf">up</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">minHeap</span><span class="p">)</span> <span class="nf">Peek</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MaxInt</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">minHeap</span><span class="p">)</span> <span class="nf">Pop</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MaxInt</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">val</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nf">down</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">maxHeap</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">val</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span><span class="p">]</span> <span class="p">=</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nf">up</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">maxHeap</span><span class="p">)</span> <span class="nf">Pop</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MinInt</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">val</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nf">down</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">maxHeap</span><span class="p">)</span> <span class="nf">Peek</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MinInt</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">maxHeap</span><span class="p">)</span> <span class="nf">up</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">index</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">index</span> <span class="p">=</span> <span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">maxHeap</span><span class="p">)</span> <span class="nf">down</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="mi">2</span><span class="o">*</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">j</span> <span class="o">:=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span> <span class="p">=</span> <span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">index</span> <span class="p">=</span> <span class="nx">j</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">minHeap</span><span class="p">)</span> <span class="nf">up</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">index</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[(</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">index</span> <span class="p">=</span> <span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">minHeap</span><span class="p">)</span> <span class="nf">down</span><span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="mi">2</span><span class="o">*</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">j</span> <span class="o">:=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">num</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span> <span class="p">=</span> <span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">m</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">index</span> <span class="p">=</span> <span class="nx">j</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newMinHeap</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">minHeap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">minHeap</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">elements</span><span class="p">:</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">num</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newMaxHeap</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">maxHeap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">maxHeap</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">elements</span><span class="p">:</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">num</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">minHeap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">elements</span> <span class="p">[]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">num</span>      <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">maxHeap</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">elements</span> <span class="p">[]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">num</span>      <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h2 id="最右">最右</h2>
<h3 id="20230712-最右一面挂">20230712 最右一面（挂）</h3>
<ul>
<li>
<p>场景设计题：有一个热榜帖子，每分钟,刷新10条帖子，最近24小时热度最高的100个帖子：使用redis的zet做延迟队列，时间戳作为score，存储任务，然后另外一个redis的zset存储这个</p>
<ul>
<li>延迟队列具体怎么做？</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">--delayQueue:</span>
</span></span><span class="line"><span class="cl"><span class="c1">--key:hashTag+merge_messages</span>
</span></span><span class="line"><span class="cl"><span class="c1">--filed:guild_id:event_id:ip:hashTag</span>
</span></span><span class="line"><span class="cl"><span class="c1">--score:时间戳</span>
</span></span><span class="line"><span class="cl"><span class="c1">--workQueue:带过期时间</span>
</span></span><span class="line"><span class="cl"><span class="c1">--key:guild_id:event_id:ip:hashTag</span>
</span></span><span class="line"><span class="cl"><span class="c1">--filed:data（kafka数据）</span>
</span></span><span class="line"><span class="cl"><span class="c1">--score: 最后一个score</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">score</span> <span class="o">=</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZSCORE&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="n">score</span> <span class="o">==</span> <span class="kc">false</span> <span class="ow">or</span> <span class="n">score</span> <span class="o">%%</span> <span class="o">%</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">then</span>
</span></span><span class="line"><span class="cl"><span class="n">score</span> <span class="o">=</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZADD&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;ZADD&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">score</span><span class="p">,</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXPIRE&#39;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
</li>
</ul>
<h2 id="百度">百度</h2>
<h3 id="20230713-百度一面过">20230713 百度一面（过）</h3>
<ul>
<li>表分裂的时候数据读写怎么办？表分裂比较低频，分裂过程大概100ms以内</li>
<li>对于其它技术了解的怎么样？</li>
</ul>
<p><strong>合并n个有序链表，并对结果去重:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">listNode</span> <span class="kd">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">val</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span> <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">mergeListNodes</span><span class="p">(</span><span class="nx">nodes</span> <span class="p">[]</span><span class="o">*</span><span class="nx">listNode</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">r</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">listNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">l</span><span class="p">&gt;</span><span class="nx">r</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ni</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">l</span><span class="o">==</span><span class="nx">r</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">m</span><span class="o">:=</span><span class="nx">l</span><span class="o">+</span><span class="p">(</span><span class="nx">r</span><span class="o">-</span><span class="nx">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">  <span class="nx">h1</span><span class="p">,</span><span class="nx">h2</span><span class="o">:=</span><span class="nf">mergeListNodes</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">m</span><span class="p">),</span><span class="nf">mergeListNodes</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span><span class="nx">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">merge</span><span class="p">(</span><span class="nx">h1</span><span class="p">,</span><span class="nx">h2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">merge</span><span class="p">(</span><span class="nx">h1</span><span class="p">,</span><span class="nx">h2</span> <span class="o">*</span><span class="nx">listNode</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">h1</span><span class="o">==</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">h2</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">h2</span><span class="o">==</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">h1</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">t</span> <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">h1</span><span class="p">.</span><span class="nx">val</span><span class="p">&lt;</span><span class="nx">h2</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">=</span><span class="nx">h1</span>
</span></span><span class="line"><span class="cl">    <span class="nx">h1</span><span class="p">=</span><span class="nx">h1</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">=</span><span class="nx">h2</span>
</span></span><span class="line"><span class="cl">    <span class="nx">h2</span><span class="p">=</span><span class="nx">h2</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">p</span><span class="o">:=</span><span class="nx">t</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">h1</span><span class="o">!=</span><span class="kc">nil</span><span class="o">&amp;&amp;</span><span class="nx">h2</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">h1</span><span class="p">.</span><span class="nx">val</span><span class="p">&lt;</span><span class="nx">h2</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">val</span><span class="o">!=</span><span class="nx">h1</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">.</span><span class="nx">next</span><span class="p">=</span><span class="nx">h1</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h1</span><span class="p">=</span><span class="nx">h1</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">val</span><span class="o">!=</span><span class="nx">h2</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">.</span><span class="nx">next</span><span class="p">=</span><span class="nx">h2</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h2</span><span class="p">=</span><span class="nx">h2</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">h1</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">val</span><span class="o">!=</span><span class="nx">h1</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">.</span><span class="nx">next</span><span class="p">=</span><span class="nx">h1</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h1</span><span class="p">=</span><span class="nx">h1</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">h2</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">val</span><span class="o">!=</span><span class="nx">h2</span><span class="p">.</span><span class="nx">val</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">.</span><span class="nx">next</span><span class="p">=</span><span class="nx">h2</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span><span class="p">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h2</span><span class="p">=</span><span class="nx">h2</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">t</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>第k个全排列：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">kthPermutations</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">times</span><span class="p">,</span> <span class="nx">find</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="nf">dfs</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">bool</span><span class="p">,</span> <span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="o">&amp;</span><span class="nx">times</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">dfs</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">k</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">t</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">res</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">visited</span> <span class="p">[]</span><span class="kt">bool</span><span class="p">,</span> <span class="nx">times</span> <span class="o">*</span><span class="kt">int</span><span class="p">,</span> <span class="nx">find</span> <span class="o">*</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="o">*</span><span class="nx">find</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">t</span> <span class="o">==</span> <span class="nx">n</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="nx">times</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">*</span><span class="nx">times</span> <span class="o">==</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="nx">find</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">*</span><span class="nx">find</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="p">=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">		<span class="nf">dfs</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">visited</span><span class="p">,</span> <span class="nx">times</span><span class="p">,</span> <span class="nx">find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="20230720-百度二面过">20230720 百度二面（过）</h3>
<ul>
<li>谈谈对go语言的理解，和java比较</li>
<li>go语言面向对象</li>
<li>go语言的并发、协程，底层原理</li>
<li>项目，项目架构、难点，抠细节。</li>
</ul>
<p><strong>一个二维有序数组，判断某个数是否在这个二维有序数组中</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">findTarget</span><span class="p">(</span><span class="nx">matrix</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">target</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">matrix</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">matrix</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nx">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">==</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">i</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="迅雷">迅雷</h2>
<h3 id="20230714-迅雷一面过">20230714 迅雷一面（过）</h3>
<ul>
<li>redis异地多活，多写同一个key方案？</li>
<li>MySQL分表原则。</li>
<li>为啥不能使用外键，外键的坑有哪些？</li>
</ul>
<h3 id="20230718-迅雷二面挂">20230718 迅雷二面（挂）</h3>
<ul>
<li>设计一个100亿级别的用户打卡系统，找出前排名前1w的用户</li>
<li>项目难点以及怎么解决的？</li>
<li>对于未来的规划？</li>
</ul>
<h2 id="滴滴">滴滴</h2>
<h3 id="20230715-滴滴一面过">20230715 滴滴一面（过）</h3>
<ul>
<li>
<p>Golang判空怎么判空，判空的坑？</p>
</li>
<li>
<p>new 和make的区别，内存分配怎么分配？new用于所有对象，make限制了slice、map、channel，new内存分配都在堆上，make有可能在栈上。</p>
</li>
<li>
<p>defer的作用域</p>
</li>
<li>
<p>切片和数组区别，函数传递是值传递还是引用传递？</p>
</li>
<li>
<p>限流算法有哪些？怎么实现一个限流器？分布式限流器？</p>
<blockquote>
<p><strong>本地限流器：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">rateLimit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// RateLimiter 限流接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">RateLimiter</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Allow 是否运行本次请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">Allow</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// NewLeakyRater 漏桶算法限流实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewLeakyRater</span><span class="p">(</span><span class="nx">rate</span><span class="p">,</span> <span class="nx">capacity</span> <span class="kt">int64</span><span class="p">)</span> <span class="nx">RateLimiter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">leakyBucket</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">rate</span><span class="p">:</span>       <span class="nx">rate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">capacity</span><span class="p">:</span>   <span class="nx">capacity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">lastLeakMs</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">mu</span><span class="p">:</span>         <span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// NewTokenRater 令牌桶算法限流实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewTokenRater</span><span class="p">(</span><span class="nx">rate</span><span class="p">,</span> <span class="nx">capacity</span> <span class="kt">int64</span><span class="p">)</span> <span class="nx">RateLimiter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">tokenBucket</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">rate</span><span class="p">:</span>       <span class="nx">rate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">capacity</span><span class="p">:</span>   <span class="nx">capacity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">lastFillMs</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nx">mu</span><span class="p">:</span>         <span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">leakyBucket</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rate</span>       <span class="kt">int64</span>       <span class="c1">// 每s能够处理的请求个数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">capacity</span>   <span class="kt">int64</span>       <span class="c1">// 最多能够容纳的请求数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">water</span>      <span class="kt">int64</span>       <span class="c1">// 当前处理的请求数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">lastLeakMs</span> <span class="kt">int64</span>       <span class="c1">// 上次泄漏的时间戳（毫秒）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">mu</span>         <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span> <span class="c1">// 互斥锁，保证线程安全
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">leakyBucket</span><span class="p">)</span> <span class="nf">Allow</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">l</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>         <span class="c1">// 加锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">defer</span> <span class="nx">l</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span> <span class="c1">// 函数结束时解锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nx">nowMs</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e6</span>              <span class="c1">// 获取当前时间戳（毫秒）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">leakNum</span> <span class="o">:=</span> <span class="p">(</span><span class="nx">nowMs</span> <span class="o">-</span> <span class="nx">l</span><span class="p">.</span><span class="nx">lastLeakMs</span><span class="p">)</span> <span class="o">*</span> <span class="nx">l</span><span class="p">.</span><span class="nx">rate</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 计算从上次泄漏到现在泄漏的水量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">l</span><span class="p">.</span><span class="nx">water</span> <span class="o">-=</span> <span class="nx">leakNum</span>                                <span class="c1">// 更新水量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">l</span><span class="p">.</span><span class="nx">lastLeakMs</span> <span class="p">=</span> <span class="nx">nowMs</span>                              <span class="c1">// 更新上次泄漏时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">water</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">// 如果水量小于0，将水量设置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  	<span class="nx">l</span><span class="p">.</span><span class="nx">water</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">water</span> <span class="p">&lt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">capacity</span> <span class="p">{</span> <span class="c1">// 判断是否允许新的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  	<span class="nx">l</span><span class="p">.</span><span class="nx">water</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">  	<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">tokenBucket</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rate</span>       <span class="kt">int64</span>       <span class="c1">// 令牌生成速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">capacity</span>   <span class="kt">int64</span>       <span class="c1">// 令牌桶容量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">tokens</span>     <span class="kt">int64</span>       <span class="c1">// 当前令牌数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">lastFillMs</span> <span class="kt">int64</span>       <span class="c1">// 上次填充令牌的时间戳（毫秒）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">mu</span>         <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span> <span class="c1">// 互斥锁，保证线程安全
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">tokenBucket</span><span class="p">)</span> <span class="nf">Allow</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>         <span class="c1">// 加锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">defer</span> <span class="nx">t</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span> <span class="c1">// 函数结束时解锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nx">nowMs</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e6</span>              <span class="c1">// 获取当前时间戳（毫秒）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">fillNum</span> <span class="o">:=</span> <span class="p">(</span><span class="nx">nowMs</span> <span class="o">-</span> <span class="nx">t</span><span class="p">.</span><span class="nx">lastFillMs</span><span class="p">)</span> <span class="o">*</span> <span class="nx">t</span><span class="p">.</span><span class="nx">rate</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 计算从上次填充到现在新增的令牌数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">t</span><span class="p">.</span><span class="nx">tokens</span> <span class="o">+=</span> <span class="nx">fillNum</span>                               <span class="c1">// 更新令牌数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">t</span><span class="p">.</span><span class="nx">lastFillMs</span> <span class="p">=</span> <span class="nx">nowMs</span>                              <span class="c1">// 更新上次填充时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">tokens</span> <span class="p">&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">capacity</span> <span class="p">{</span> <span class="c1">// 如果令牌数量大于容量，将令牌数量设置为容量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  	<span class="nx">t</span><span class="p">.</span><span class="nx">tokens</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">capacity</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">tokens</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">// 判断是否允许新的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  	<span class="nx">t</span><span class="p">.</span><span class="nx">tokens</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">  	<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>分布式限流器：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">-- 漏桶算法</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- leaky_bucket.lua</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">key</span> <span class="o">=</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">-- Redis key</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">-- 漏桶处理速率</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">capacity</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">-- 漏桶容量</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">now_ms</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">-- 当前时间戳（毫秒）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 从Redis中获取漏桶的当前水量和上次泄漏时间</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">leaky_bucket</span> <span class="o">=</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HMGET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">,</span> <span class="s1">&#39;last_leak_ms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">water</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">leaky_bucket</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">last_leak_ms</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">leaky_bucket</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 计算从上次泄漏到现在泄漏的水量</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">leak_num</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">((</span><span class="n">now_ms</span> <span class="o">-</span> <span class="n">last_leak_ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">rate</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">water</span> <span class="o">=</span> <span class="n">water</span> <span class="o">-</span> <span class="n">leak_num</span>
</span></span><span class="line"><span class="cl"><span class="n">last_leak_ms</span> <span class="o">=</span> <span class="n">now_ms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 如果水量小于0，将水量设置为0</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">water</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl"><span class="n">water</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 判断是否允许新的请求</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">allowed</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">water</span> <span class="o">&lt;</span> <span class="n">capacity</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl"><span class="n">water</span> <span class="o">=</span> <span class="n">water</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">allowed</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 更新Redis中的漏桶状态</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HMSET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="s1">&#39;last_leak_ms&#39;</span><span class="p">,</span> <span class="n">last_leak_ms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXPIRE&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">capacity</span> <span class="o">/</span> <span class="n">rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">allowed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 令牌桶算法</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- token_bucket.lua</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">key</span> <span class="o">=</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">-- Redis key</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">-- 令牌生成速率</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">capacity</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">-- 令牌桶容量</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">now_ms</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">-- 当前时间戳（毫秒）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 从Redis中获取令牌桶的当前令牌数量和上次填充时间</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">token_bucket</span> <span class="o">=</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HMGET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;last_fill_ms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">token_bucket</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">last_fill_ms</span> <span class="o">=</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">token_bucket</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 计算从上次填充到现在新增的令牌数量</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">fill_num</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">((</span><span class="n">now_ms</span> <span class="o">-</span> <span class="n">last_fill_ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">rate</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span> <span class="o">+</span> <span class="n">fill_num</span>
</span></span><span class="line"><span class="cl"><span class="n">last_fill_ms</span> <span class="o">=</span> <span class="n">now_ms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 如果令牌数量大于容量，将令牌数量设置为容量</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">tokens</span> <span class="o">&gt;</span> <span class="n">capacity</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl"><span class="n">tokens</span> <span class="o">=</span> <span class="n">capacity</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 判断是否允许新的请求</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">allowed</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">tokens</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl"><span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">allowed</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 更新Redis中的令牌桶状态</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HMSET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="s1">&#39;last_fill_ms&#39;</span><span class="p">,</span> <span class="n">last_fill_ms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXPIRE&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">capacity</span> <span class="o">/</span> <span class="n">rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">allowed</span>		
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
</li>
</ul>
<p><strong>全排列：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// nums不重复，给出全排列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">dfs</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span><span class="nx">t</span> <span class="kt">int</span><span class="p">,</span><span class="nx">tmp</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span><span class="nx">visited</span> <span class="p">[]</span><span class="kt">bool</span><span class="p">,</span><span class="nx">res</span> <span class="o">*</span><span class="p">[][]</span><span class="kt">int</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">t</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:=</span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="p">=</span><span class="nb">append</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">tmp</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">res</span><span class="p">=</span><span class="nb">append</span><span class="p">(</span><span class="o">*</span><span class="nx">res</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]{</span>
</span></span><span class="line"><span class="cl">          <span class="k">continue</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">tmp</span><span class="p">[</span><span class="nx">t</span><span class="p">]=</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]=</span><span class="kc">true</span>
</span></span><span class="line"><span class="cl">    	<span class="nf">dfs</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span><span class="nx">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">visited</span><span class="p">,</span><span class="nx">tmp</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">visited</span><span class="p">[</span><span class="nx">i</span><span class="p">]=</span><span class="kc">false</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>岛屿问题：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">countGrid</span><span class="p">(</span><span class="nx">grids</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">)</span><span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="o">:=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="o">:=</span><span class="nb">len</span><span class="p">(</span><span class="nx">grids</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="nx">grids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nx">m</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">j</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">j</span><span class="p">&lt;</span><span class="nx">n</span><span class="p">;</span><span class="nx">j</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">grids</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">grids</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// gridBfs(grids,m,n,i,j)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// gridDfs 感染，深度优先搜索
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">grids</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span> <span class="kt">int</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">i</span><span class="p">&lt;</span><span class="mi">0</span><span class="o">||</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">m</span><span class="o">||</span><span class="nx">j</span><span class="p">&lt;</span><span class="mi">0</span><span class="o">||</span><span class="nx">j</span><span class="o">&gt;=</span><span class="nx">n</span><span class="o">||</span><span class="nx">grids</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]=</span><span class="mi">0</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="k">return</span> 
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">grids</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">girds</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">girds</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">girds</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">gridDfs</span><span class="p">(</span><span class="nx">girds</span><span class="p">,</span><span class="nx">m</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// gridBfs 感染，广度优先搜索
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">gridBfs</span><span class="p">(</span><span class="nx">grids</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dx</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dy</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span> <span class="o">:=</span> <span class="nf">newQueue</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pair</span><span class="p">{</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">!</span><span class="nx">q</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span> <span class="o">:=</span> <span class="nx">q</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">k</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="p">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 上下左右四个方向寻找
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="c1">// 当前位置的下一个位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="nx">grids</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">q</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pair</span><span class="p">{</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">				<span class="nx">grids</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">pair</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">x</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">y</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">queue</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">elements</span> <span class="p">[]</span><span class="o">*</span><span class="nx">pair</span>
</span></span><span class="line"><span class="cl">	<span class="nx">begin</span>    <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">end</span>      <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newQueue</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">queue</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">queue</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">elements</span><span class="p">:</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">pair</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">begin</span><span class="p">:</span>    <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">end</span><span class="p">:</span>      <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">q</span> <span class="o">*</span><span class="nx">queue</span><span class="p">)</span> <span class="nf">push</span><span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">pair</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span><span class="p">.</span><span class="nx">end</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">q</span><span class="p">.</span><span class="nx">end</span><span class="p">]</span> <span class="p">=</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">q</span> <span class="o">*</span><span class="nx">queue</span><span class="p">)</span> <span class="nf">pop</span><span class="p">()</span> <span class="o">*</span><span class="nx">pair</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">q</span><span class="p">.</span><span class="nx">begin</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="nx">q</span><span class="p">.</span><span class="nx">begin</span><span class="p">]</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">q</span><span class="p">.</span><span class="nx">begin</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">q</span> <span class="o">*</span><span class="nx">queue</span><span class="p">)</span> <span class="nf">isEmpty</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">q</span><span class="p">.</span><span class="nx">end</span> <span class="p">&lt;</span> <span class="nx">q</span><span class="p">.</span><span class="nx">begin</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="20230715-滴滴二面挂">20230715 滴滴二面（挂）</h3>
<ul>
<li>redis分布式锁的坑？锁过期，任务还没完成该怎么办？锁定时续期？</li>
<li>redis怎么实现一个可重入分布式锁？</li>
</ul>
<blockquote>
<p>redis的hash+lua脚本</p>
<p><strong>加锁：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">-- key:hash的key，一般是业务的锁</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- expireTime: 过期时间</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- requestId:本次请求的唯一ID，可以理解为traceID，全局唯一</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- TryGetLock</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">TryGetLock</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="kr">if</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXISTS&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">     <span class="c1">-- 锁不存在，尝试获取锁</span>
</span></span><span class="line"><span class="cl">     <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HSET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PEXPIRE&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="kr">return</span> <span class="mi">1</span><span class="p">,</span> <span class="n">expireTime</span> <span class="c1">-- initialize</span>
</span></span><span class="line"><span class="cl"> <span class="kr">else</span>
</span></span><span class="line"><span class="cl">     <span class="c1">-- 锁存在，检查是否是同一个请求ID</span>
</span></span><span class="line"><span class="cl">     <span class="kr">if</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HEXISTS&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">         <span class="c1">-- 是同一个请求ID，增加计数</span>
</span></span><span class="line"><span class="cl">         <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HINCRBY&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PEXPIRE&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="kr">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PTTL&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="c1">-- success</span>
</span></span><span class="line"><span class="cl">     <span class="kr">else</span>
</span></span><span class="line"><span class="cl">         <span class="c1">-- 不是同一个请求ID，获取锁失败</span>
</span></span><span class="line"><span class="cl">         <span class="kr">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PTTL&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="c1">-- failed</span>
</span></span><span class="line"><span class="cl">     <span class="kr">end</span>
</span></span><span class="line"><span class="cl"> <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>解锁：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">-- key:hash的key，一般是业务的锁</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- requestId:本次请求的唯一ID，可以理解为traceID，全局唯一</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- expireTime: 过期时间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- TryUnLock</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">TryUnLock</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="kr">if</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;EXISTS&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">     <span class="c1">-- 锁不存在，释放锁成功</span>
</span></span><span class="line"><span class="cl">     <span class="kr">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="c1">-- success</span>
</span></span><span class="line"><span class="cl"> <span class="kr">else</span>
</span></span><span class="line"><span class="cl">     <span class="c1">-- 锁存在，检查是否是同一个请求ID</span>
</span></span><span class="line"><span class="cl">     <span class="kr">if</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HEXISTS&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">         <span class="kd">local</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HGET&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="kr">if</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">             <span class="c1">-- 计数为1，删除锁</span>
</span></span><span class="line"><span class="cl">             <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HDEL&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="kr">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="c1">-- success</span>
</span></span><span class="line"><span class="cl">         <span class="kr">else</span>
</span></span><span class="line"><span class="cl">             <span class="c1">-- 是同一个请求ID，减少计数</span>
</span></span><span class="line"><span class="cl">             <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;HINCRBY&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">requestId</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="c1">-- 给锁续期</span>
</span></span><span class="line"><span class="cl">             <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PEXPIRE&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="kr">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PTTL&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="c1">-- failed</span>
</span></span><span class="line"><span class="cl">         <span class="kr">end</span>
</span></span><span class="line"><span class="cl">     <span class="kr">else</span>
</span></span><span class="line"><span class="cl">         <span class="c1">-- 不是同一个请求ID，释放锁失败</span>
</span></span><span class="line"><span class="cl">         <span class="kr">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">&#39;PTTL&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="c1">-- failed</span>
</span></span><span class="line"><span class="cl">     <span class="kr">end</span>
</span></span><span class="line"><span class="cl"> <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<ul>
<li>怎么提供个分布式的redis对外使用？proxy、redis自适应hash、客户端hash</li>
<li>当MySQL表中某一列的类型是varchar，但是在sql语句中使用int查询，会有什么问题？性能下降、查询结果不准确，索引失效</li>
</ul>
<blockquote>
<p>1.在进行函数运算的时候，mysql会进行隐式转换，比如原始数据是varchar，varchar按照某种规则有序，转换成整数后可能排序规则就变了，就没法使用索引了，只能走全表扫描</p>
<p>2.函数运算本身也要时间的，这个会增加整体耗时。</p>
<p>3.函数转换的结果可能不准确，a123可能转成123，导致查询结果不准确</p>
</blockquote>
<ul>
<li>redis的cluster是怎么实现的？meet命令，分片集群，槽位。</li>
<li>varchar、char、text区别？如何选用哪种数据结构？varcha最大能存储的字符数，能全部存储数据吗？</li>
</ul>
<blockquote>
<ol>
<li>char:定长字符串，性能更好，但可能会浪费存储空间</li>
<li>varchar :变长字符，最大存储字符长度是(1&laquo;16)-1,更节省空间，性能稍差。</li>
<li>text：文本，能够存储的长度最长，但是性能更差。</li>
</ol>
</blockquote>
<ul>
<li>
<p>快照读和当前读，怎么实现快照读和当前读？多版本并发控制？</p>
<blockquote>
<p>InnoDB存储引擎通过多版本并发控制（MVCC）实现了高并发性能和事务隔离。以下是InnoDB实现MVCC的具体细节：</p>
<ol>
<li>事务版本号（Transaction ID）：</li>
</ol>
<p>InnoDB为每个事务分配一个唯一的递增的版本号，称为事务ID。事务ID用于标识事务的先后顺序，以及在MVCC中确定数据行的可见性。</p>
<ol start="2">
<li>Undo日志：</li>
</ol>
<p>InnoDB使用Undo日志来存储数据行的旧版本。当事务对数据行进行修改时，InnoDB会将修改前的数据行版本写入Undo日志。Undo日志分为两种：Insert Undo和Update Undo。Insert Undo用于存储新插入数据行的旧版本，Update Undo用于存储更新数据行的旧版本。</p>
<ol start="3">
<li>Read View：</li>
</ol>
<p>InnoDB为每个事务创建一个Read View，用于确定数据行的可见性。Read View包含以下信息：</p>
<ul>
<li>事务的版本号（即快照版本号）。</li>
<li>当前活跃的事务列表（即在Read View创建时尚未提交的事务）。</li>
</ul>
<p>Read View用于判断数据行的某个版本是否对当前事务可见。具体规则如下：</p>
<ul>
<li>如果数据行的版本号小于等于Read View的版本号，并且不属于活跃事务列表，则该数据行对当前事务可见。</li>
<li>如果数据行的版本号大于Read View的版本号，或者属于活跃事务列表，则该数据行对当前事务不可见，需要查找其旧版本。</li>
</ul>
<ol>
<li>数据行结构：</li>
</ol>
<p>InnoDB的数据行包含以下与MVCC相关的系统列：</p>
<ul>
<li>DB_TRX_ID：表示最后修改数据行的事务ID。</li>
<li>DB_ROLL_PTR：表示指向数据行的上一个版本（即Undo日志）的指针。</li>
</ul>
<ol start="2">
<li>数据行可见性判断：</li>
</ol>
<p>当事务需要读取数据行时，InnoDB会根据Read View和数据行的系统列判断数据行的可见性。具体步骤如下：</p>
<ul>
<li>检查数据行的DB_TRX_ID，如果小于等于Read View的版本号，并且不属于活跃事务列表，则该数据行对当前事务可见，可以直接返回。</li>
<li>如果数据行的DB_TRX_ID大于Read View的版本号，或者属于活跃事务列表，则该数据行对当前事务不可见，需要查找其旧版本。此时，通过DB_ROLL_PTR找到对应的Undo日志，并递归判断Undo日志中的数据行版本是否可见。</li>
</ul>
<ol start="3">
<li>数据行修改：</li>
</ol>
<p>当事务需要修改数据行时，InnoDB会执行以下操作：</p>
<ul>
<li>为修改后的数据行分配一个新的事务ID（即当前事务的ID）。</li>
<li>将修改前的数据行版本写入Undo日志，并更新数据行的DB_ROLL_PTR指向Undo日志。</li>
<li>如果当前事务是第一个修改数据行的事务，还需要将数据行的DB_TRX_ID更新为当前事务的ID。</li>
</ul>
<p>通过上述机制，InnoDB实现了MVCC，支持多个事务并发访问数据，同时保证了事务隔离性。需要注意的是，InnoDB的MVCC实现与事务隔离级别有关。在不同的隔离级别下，Read View的创建时机和数据行可见性判断规则可能会有所不同。</p>
</blockquote>
</li>
<li>
<p>快照读和当前读</p>
</li>
</ul>
<blockquote>
<p>InnoDB通过在每个数据行中添加额外的系统列（如DB_TRX_ID和DB_ROLL_PTR）来维护数据的多个版本。</p>
<ol>
<li>快照读（Snapshot Read）：</li>
</ol>
<p>在InnoDB中，快照读主要用于实现可重复读（Repeatable Read）隔离级别。当事务开始时，InnoDB会为该事务分配一个唯一的事务ID，并记录当前的系统版本号作为快照版本号。</p>
<p>当事务需要读取数据时，InnoDB会遍历数据行的版本链表，找到版本号小于等于快照版本号的最新版本。具体步骤如下：</p>
<ul>
<li>检查数据行的DB_TRX_ID，如果小于等于快照版本号，说明该行数据在事务开始前已经存在，可以直接返回。</li>
<li>如果数据行的DB_TRX_ID大于快照版本号，说明该行数据是在事务开始后被其他事务插入或更新的。此时，需要通过DB_ROLL_PTR找到该行数据的上一个版本。</li>
<li>递归检查上一个版本的DB_TRX_ID，直到找到一个版本号小于等于快照版本号的数据行，然后返回该行数据。</li>
</ul>
<ol start="2">
<li>当前读（Current Read）：</li>
</ol>
<p>在InnoDB中，当前读主要用于实现读已提交（Read Committed）隔离级别。当事务需要读取数据时，InnoDB会直接返回数据行的最新版本。具体步骤如下：</p>
<ul>
<li>检查数据行的DB_TRX_ID，如果小于等于当前事务ID，说明该行数据在当前事务开始前已经存在，可以直接返回。</li>
<li>如果数据行的DB_TRX_ID大于当前事务ID，说明该行数据是在当前事务开始后被其他事务插入或更新的。此时，需要通过DB_ROLL_PTR找到该行数据的上一个版本。</li>
<li>递归检查上一个版本的DB_TRX_ID，直到找到一个版本号小于等于当前事务ID的数据行，然后返回该行数据。</li>
</ul>
<p>需要注意的是，当前读可能导致不可重复读和幻读等问题。为了解决这些问题，InnoDB还提供了行锁和间隙锁等锁机制来实现更高的隔离级别。</p>
</blockquote>
<ul>
<li>cap理论，分区容错性必须得保证，可用性和一致性取舍，当为了高可用牺牲部分一致性的时候，有哪些手段可以尽量保证数据一致性？</li>
</ul>
<blockquote>
<ol>
<li>数据对账</li>
<li>读修复，自修复能力。</li>
<li>定时巡检，数据不一致上报。</li>
<li>异步消息队列，消费对账。</li>
</ol>
</blockquote>
<ul>
<li>go语言判空的坑</li>
</ul>
<p><strong>两个协程交替打印0和1，一个只打印0，一个只打印1:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">printDigit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch1</span><span class="p">,</span> <span class="nx">ch2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{}),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">	<span class="kd">const</span> <span class="nx">printNum</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">printNum</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">&lt;-</span><span class="nx">ch1</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;goroutinue1:&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ch2</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">printNum</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">&lt;-</span><span class="nx">ch2</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;goroutinue2:&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">i</span> <span class="o">!=</span> <span class="nx">printNum</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span><span class="c1">// 因为在外面ch1先塞了一次，所以这里要少塞一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">ch1</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span> 
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ch1</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>最长回文子串：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">palindromeSubString</span><span class="p">(</span><span class="nx">str</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">n</span><span class="o">:=</span><span class="nb">len</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dp</span><span class="o">:=</span><span class="nb">make</span><span class="p">([][]</span><span class="kt">bool</span><span class="p">,</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nx">n</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">]=</span><span class="nb">make</span><span class="p">([]</span><span class="kt">bool</span><span class="p">,</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">i</span><span class="p">]=</span><span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">i</span><span class="p">&lt;</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]=</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">==</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">maxLen</span><span class="p">,</span><span class="nx">beginIndex</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">l</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span><span class="nx">l</span><span class="o">&lt;=</span><span class="nx">n</span><span class="p">;</span><span class="nx">l</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">+</span><span class="nx">l</span><span class="o">&lt;=</span><span class="nx">n</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">i</span><span class="o">+</span><span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]=</span><span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="nx">i</span><span class="o">+</span><span class="nx">l</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">==</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">dp</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">i</span><span class="o">+</span><span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxLen</span><span class="p">=</span><span class="nx">l</span>
</span></span><span class="line"><span class="cl">        <span class="nx">beginIndex</span><span class="p">=</span><span class="nx">i</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">str</span><span class="p">[</span><span class="nx">beginIndex</span><span class="p">:</span><span class="nx">maxLen</span><span class="o">+</span><span class="nx">beginIndex</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="莉莉丝">莉莉丝</h2>
<h3 id="20230721-莉莉丝一面过">20230721 莉莉丝一面（过）</h3>
<ul>
<li>聊项目难点</li>
<li>聚簇索引和非聚簇索引</li>
<li>redis的持久化方式？</li>
<li>redis挂了怎么办？</li>
</ul>
<h2 id="小红书hr挂">小红书（HR挂）</h2>
<h3 id="20230727-小红书一面过">20230727 小红书一面（过）</h3>
<ul>
<li>mysql的事务，为什么用到事务？</li>
<li>java的jvm以及垃圾回收机制</li>
<li>java的hashmap和concurrent hashmap</li>
<li>项目难点，负责模块</li>
<li>mysql的索引，b+树</li>
<li>mysql的事务原子性怎么保证的？</li>
<li>两个事务同时更新一条数据会发生什么？</li>
</ul>
<blockquote>
<p>会阻塞，因为更新同一行数据自动使用排它锁</p>
</blockquote>
<ul>
<li>二叉树最大路径和</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getMaxPath</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">Tree</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">root</span><span class="o">==</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">result</span><span class="o">:=</span><span class="nx">root</span><span class="p">.</span><span class="nx">val</span>
</span></span><span class="line"><span class="cl"><span class="nf">postOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">postOrder</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">Tree</span><span class="p">,</span><span class="nx">result</span> <span class="o">*</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">root</span><span class="o">==</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">l</span><span class="p">,</span><span class="nx">r</span><span class="o">:=</span><span class="nf">postOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span><span class="nx">result</span><span class="p">),</span><span class="nf">postOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">mx</span><span class="o">:=</span><span class="nf">max</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span><span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">mx</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="nx">mx</span><span class="p">,</span><span class="nx">l</span><span class="o">+</span><span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">mx</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="nx">mx</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="nx">result</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="o">*</span><span class="nx">result</span><span class="p">,</span><span class="nx">mx</span><span class="o">+</span><span class="nx">root</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nf">max</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span><span class="nx">r</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="nx">root</span><span class="p">.</span><span class="nx">val</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">max</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">a</span><span class="p">&lt;</span><span class="nx">b</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="20230801-小红书二面过">20230801 小红书二面（过）</h3>
<ul>
<li>项目大概30min</li>
<li>写一个线上可以使用的localCache，使用lru作为淘汰算法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;hash/fnv&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;sync/atomic&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">errEmptyCache</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;not initialization&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">errInvalidKey</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">errNotExist</span>   <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;not existed key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cache</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewLocalCache</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;NewLocalCache failed:%+v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">18</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;key%d&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">val</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;val%d&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;set cache failed;key:%s,val:%s failed:%+v&#34;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">cache</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">totalKeyNum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cache</span><span class="p">.</span><span class="nf">Iterator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;key3&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cache</span><span class="p">.</span><span class="nf">Iterator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">LocalCache</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">totalKeyNum</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">	<span class="nx">shards</span>      <span class="p">[]</span><span class="o">*</span><span class="nx">lru</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewLocalCache</span><span class="p">(</span><span class="nx">eachShardSize</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">shardNum</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">LocalCache</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">eachShardSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">shardNum</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errEmptyCache</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dataList</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">lru</span><span class="p">,</span> <span class="nx">shardNum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">dataList</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dataList</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nf">newLRU</span><span class="p">(</span><span class="nx">eachShardSize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">LocalCache</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">shards</span><span class="p">:</span> <span class="nx">dataList</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">LocalCache</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errInvalidKey</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">index</span> <span class="o">:=</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errNotExist</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nf">readPreheat</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">LocalCache</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">val</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">errEmptyCache</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">errInvalidKey</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">index</span> <span class="o">:=</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">val</span> <span class="p">=</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span><span class="p">.</span><span class="nf">readPreheat</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">newNode</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">val</span><span class="p">:</span>  <span class="nx">val</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">next</span><span class="p">:</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">pre</span><span class="p">:</span>  <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">key</span><span class="p">:</span>  <span class="nx">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">newNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">newNode</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">shardKeyNum</span> <span class="o">==</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">size</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">deleteNode</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">tail</span><span class="p">.</span><span class="nx">pre</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">tail</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">deleteNode</span><span class="p">.</span><span class="nx">pre</span>
</span></span><span class="line"><span class="cl">		<span class="nx">deleteNode</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">tail</span>
</span></span><span class="line"><span class="cl">		<span class="nb">delete</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">deleteNode</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">atomic</span><span class="p">.</span><span class="nf">AddInt64</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">l</span><span class="p">.</span><span class="nx">totalKeyNum</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">shardKeyNum</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">newNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">atomic</span><span class="p">.</span><span class="nf">AddInt64</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">l</span><span class="p">.</span><span class="nx">totalKeyNum</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">shardKeyNum</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">LocalCache</span><span class="p">)</span> <span class="nf">Iterator</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;shard%d  begin\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nf">iterator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;shard%d end~ \n &#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">LocalCache</span><span class="p">)</span> <span class="nf">readPreheat</span><span class="p">(</span><span class="nx">node</span> <span class="o">*</span><span class="nx">listNode</span><span class="p">,</span> <span class="nx">index</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">pre</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span><span class="p">.</span><span class="nx">shards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">head</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">lru</span><span class="p">)</span> <span class="nf">iterator</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">p</span><span class="p">.</span><span class="nx">next</span> <span class="o">!=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">tail</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;kev:%s,val:%s\n&#34;</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newLRU</span><span class="p">(</span><span class="nx">eachShardSize</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">lru</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tail</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span><span class="p">.</span><span class="nx">next</span> <span class="p">=</span> <span class="nx">tail</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tail</span><span class="p">.</span><span class="nx">pre</span> <span class="p">=</span> <span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">lru</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">size</span><span class="p">:</span> <span class="nx">eachShardSize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">head</span><span class="p">:</span> <span class="nx">head</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tail</span><span class="p">:</span> <span class="nx">tail</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">mu</span><span class="p">:</span>   <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dict</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">listNode</span><span class="p">,</span> <span class="nx">eachShardSize</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">lru</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mu</span>          <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
</span></span><span class="line"><span class="cl">	<span class="nx">size</span>        <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">shardKeyNum</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span><span class="p">,</span> <span class="nx">tail</span>  <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dict</span>        <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">listNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">key</span>       <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">val</span>       <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="nx">pre</span><span class="p">,</span> <span class="nx">next</span> <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span> <span class="o">:=</span> <span class="nx">fnv</span><span class="p">.</span><span class="nf">New32a</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">h</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nf">Sum32</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="29230808-小红书三面过">29230808 小红书三面（过）</h3>
<ul>
<li>设计的这个分表hash结构具有通用性吗</li>
<li>为啥最初选用redis作为db使用</li>
<li>项目中有哪些不稳定的地方待解决，怎么解决？</li>
<li>对未来的规划和期待</li>
</ul>
<h2 id="米哈游">米哈游</h2>
<h3 id="20230801-米哈游一面过">20230801 米哈游一面（过）</h3>
<ul>
<li>项目30min</li>
<li>没有初始化的map和slice赋值会panic，recover能捕获吗？可以捕获</li>
<li>并发读写slice和map会panic吗？recover能捕获吗？会panic不能捕获</li>
<li>如果一个channel没有初始化，读写数据会有什么问题？读写不会阻塞，也不会panic</li>
<li>如果一个channel已经close，继续读写数据会有什么问题？如果panic能捕获异常吗？读不会有问题，写会panic且不能被捕获</li>
<li>子数组的最大乘积</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">maxProduct1</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dp1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">float64</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dp2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">float64</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dp1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">dp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nx">dp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dp1</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nf">max</span><span class="p">(</span><span class="nx">dp1</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">dp2</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dp2</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nf">min</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nf">min</span><span class="p">(</span><span class="nx">dp1</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">dp2</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">dp1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">maxProduct2</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dp1</span><span class="p">,</span> <span class="nx">dp2</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="nx">dp1</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tmpDp1</span> <span class="o">:=</span> <span class="nx">dp1</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dp1</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nf">max</span><span class="p">(</span><span class="nx">dp1</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">dp2</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dp2</span> <span class="p">=</span> <span class="nf">min</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nf">min</span><span class="p">(</span><span class="nx">tmpDp1</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">dp2</span><span class="o">*</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">dp1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">max</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">a</span> <span class="p">&lt;</span> <span class="nx">b</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">min</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">a</span> <span class="p">&lt;</span> <span class="nx">b</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="20230808-米哈游二面挂">20230808 米哈游二面（挂）</h3>
<ul>
<li>聊项目30min</li>
<li>消息流量怎么解决？消息的包体会很大</li>
<li>消息空洞怎么解决？</li>
<li>消息的删除，只删除自己的消息多端同步？</li>
</ul>
<h2 id="b站">B站</h2>
<h3 id="20230802-b站一面过">20230802 B站一面（过）</h3>
<ul>
<li>主要聊项目，项目难点，表分裂</li>
<li>redis的cluster怎么实现的，如果扩容结点，redis该怎么做</li>
<li>redis的hash扩容该怎么做，是渐进式扩容吗？</li>
</ul>
<h3 id="20230804-b站二面过">20230804 B站二面（过）</h3>
<ul>
<li>
<p>聊项目30min</p>
</li>
<li>
<p>怎么保证接口幂等</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.redis <span class="nb">set</span> nx
</span></span><span class="line"><span class="cl">2.token机制+redis
</span></span><span class="line"><span class="cl">3.关系型数据库+唯一索引
</span></span><span class="line"><span class="cl">4.防重复表
</span></span><span class="line"><span class="cl">5.分布式锁
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>快排</li>
<li>为啥用hash结构，其它结构不行吗？只用hash有啥问题？</li>
</ul>
<h3 id="20230809-b站三面过">20230809 B站三面（过）</h3>
<ul>
<li>说一下你技术上最有成就感的一个事</li>
<li>非技术上最有成就感的一个事</li>
<li>长连接优势及好处</li>
<li>如果消息通道挂了，该怎么办？，有什么降级策略？</li>
</ul>
<h2 id="鹰角">鹰角</h2>
<h3 id="20230804-鹰角一面挂">20230804 鹰角一面（挂）</h3>
<ul>
<li>项目，怎么分表，怎么拆分？</li>
<li>如果要合并怎么办，子表空洞？子表合并？</li>
<li>判断回文链表</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h1</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>    <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h2</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>    <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h3</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h4</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h5</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">})</span>             <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h6</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span>                <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h7</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>       <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">h8</span> <span class="o">:=</span> <span class="nf">buildListNode</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>             <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h7</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">h8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">buildListNode</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">ListNode</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">h</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">ListNode</span><span class="p">{</span><span class="nx">Val</span><span class="p">:</span> <span class="nx">num</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">h</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">isPalindrome</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">head</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l1</span><span class="p">,</span> <span class="nx">l2</span> <span class="o">:=</span> <span class="nf">findMedium</span><span class="p">(</span><span class="nx">head</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// head = reverse(head, l1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">head</span> <span class="p">=</span> <span class="nf">reverse1</span><span class="p">(</span><span class="nx">head</span><span class="p">,</span> <span class="nx">l1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">l2</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">head</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">l2</span><span class="p">.</span><span class="nx">Val</span> <span class="o">!=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Val</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l2</span> <span class="p">=</span> <span class="nx">l2</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">head</span> <span class="p">=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">l2</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">head</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverse1</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">begin</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">end</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">begin</span> <span class="o">==</span> <span class="nx">end</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">ListNode</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">begin</span> <span class="o">!=</span> <span class="nx">end</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">next</span> <span class="o">:=</span> <span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">h</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">		<span class="nx">begin</span> <span class="p">=</span> <span class="nx">next</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">end</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">end</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">h</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverse2</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">begin</span> <span class="o">==</span> <span class="nx">end</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">p</span> <span class="o">*</span><span class="nx">ListNode</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">begin</span> <span class="o">!=</span> <span class="nx">end</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">next</span> <span class="o">:=</span> <span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span> <span class="p">=</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">		<span class="nx">begin</span> <span class="p">=</span> <span class="nx">next</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">end</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">end</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverse3</span><span class="p">(</span><span class="nx">begin</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">,</span> <span class="nx">end</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">begin</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">begin</span> <span class="o">==</span> <span class="nx">end</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">next</span> <span class="o">:=</span> <span class="nf">reverse1</span><span class="p">(</span><span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">begin</span>
</span></span><span class="line"><span class="cl">	<span class="nx">begin</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">next</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">findMedium</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">ListNode</span><span class="p">,</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">ListNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Next</span><span class="p">:</span> <span class="nx">head</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">head</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">head</span> <span class="p">=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">head</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l2</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">		<span class="nx">p</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">l2</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l2</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">l2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ListNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Val</span>  <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Next</span> <span class="o">*</span><span class="nx">ListNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h2 id="蚂蚁金服">蚂蚁金服</h2>
<h3 id="20230814-蚂蚁金服一面挂">20230814 蚂蚁金服一面（挂）</h3>
<ul>
<li>三数之和，无重复结果。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">threeSum</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sort</span><span class="p">.</span><span class="nf">Ints</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">res</span> <span class="p">[][]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="o">:=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="nx">target</span> <span class="o">:=</span> <span class="o">-</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span><span class="o">+</span><span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="o">==</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">res</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">				<span class="nx">l</span><span class="p">,</span> <span class="nx">r</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span> <span class="o">==</span> <span class="nx">l</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">left</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="o">==</span> <span class="nx">r</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">right</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span><span class="o">+</span><span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">left</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">right</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>单词数组反转，去掉多余空格</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverseWords</span><span class="p">(</span><span class="nx">words</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="p">!</span><span class="nf">isLetter</span><span class="p">(</span><span class="nx">words</span><span class="p">[</span><span class="nx">left</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">left</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="p">!</span><span class="nf">isLetter</span><span class="p">(</span><span class="nx">words</span><span class="p">[</span><span class="nx">right</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">right</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">left</span> <span class="p">&gt;</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">sb</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">words</span> <span class="p">=</span> <span class="nf">reverseStr</span><span class="p">(</span><span class="nx">words</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">j</span> <span class="o">:=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">isLetter</span><span class="p">(</span><span class="nx">words</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">bs</span> <span class="o">:=</span> <span class="nf">reverseStr</span><span class="p">(</span><span class="nx">words</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sb</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">bs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">sb</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">words</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">j</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">i</span> <span class="p">=</span> <span class="nx">j</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">sb</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverseStr</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="nx">j</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span> <span class="p">:</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">j</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">res</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">res</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">res</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">i</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="nx">j</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">isLetter</span><span class="p">(</span><span class="nx">b</span> <span class="kt">byte</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">b</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>阻塞写入该怎么办，排队，聚合写入，异步。</li>
</ul>
<h2 id="字节跳动">字节跳动</h2>
<h3 id="20230821-字节跳动一面挂">20230821 字节跳动一面（挂）</h3>
<ul>
<li>聊项目，扣细节，底层关系链怎么设计，消息怎么分发。</li>
<li>一个好的系统应该是怎么样的？</li>
<li>设计一个cache，带过期时间自动淘汰并且当数据满了的时候会使用lru算法淘汰内存</li>
</ul>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 国际化短视频
</span></span></span><span class="line"><span class="cl"><span class="c1">// tikto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">设计一个对象cache, 他支持下列两个基本操作:
</span></span></span><span class="line"><span class="cl"><span class="cm">set(id, object), 根据id设置对象;
</span></span></span><span class="line"><span class="cl"><span class="cm">get(id): 根据id得到一个对象;
</span></span></span><span class="line"><span class="cl"><span class="cm">同时它有下面几个性质:
</span></span></span><span class="line"><span class="cl"><span class="cm">1: x秒自动过期, 如果cache内的对象, x秒内没有被get或者set过, 则会自动过期;
</span></span></span><span class="line"><span class="cl"><span class="cm">2: 对象数限制, 该cache可以设置一个n, 表示cache最多能存储的对象数;
</span></span></span><span class="line"><span class="cl"><span class="cm">3: LRU置换, 当进行set操作时, 如果此时cache内对象数已经到达了n个, 则cache自动将最久未被使用过的那个对象剔除, 腾出空间放置新对象;
</span></span></span><span class="line"><span class="cl"><span class="cm">请你设计这样一个cache;
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;1&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Cache</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dict</span>           <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span><span class="p">,</span> <span class="nx">tail</span>     <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">capacity</span>       <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">expireDuration</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mu</span>             <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">New</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">x</span> <span class="kt">int64</span><span class="p">)</span> <span class="nx">Cache</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span><span class="p">,</span> <span class="nx">tail</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{},</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">head</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">tail</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tail</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cache</span> <span class="o">:=</span> <span class="nx">Cache</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">dict</span><span class="p">:</span>           <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">listNode</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">head</span><span class="p">:</span>           <span class="nx">head</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tail</span><span class="p">:</span>           <span class="nx">tail</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">capacity</span><span class="p">:</span>       <span class="nx">n</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">expireDuration</span><span class="p">:</span> <span class="nx">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">mu</span><span class="p">:</span>             <span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">200</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">cache</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="kd">const</span> <span class="nx">scanUmm</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">			<span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">dict</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">i</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="nx">scanUmm</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">break</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nx">expireTimeStamp</span> <span class="p">&lt;</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Second</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nb">delete</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="nx">v</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">					<span class="nx">v</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">cache</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">cache</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Cache</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">val</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">val</span> <span class="p">=</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">expireTimeStamp</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">expireDuration</span> <span class="o">+</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Second</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">node</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">listNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">key</span><span class="p">:</span>             <span class="nx">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">val</span><span class="p">:</span>             <span class="nx">val</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">expireTimeStamp</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">expireDuration</span> <span class="o">+</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Second</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">capacity</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">deletedNode</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">tail</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">		<span class="nb">delete</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">deletedNode</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">deletedNode</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">tail</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nx">tail</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">deletedNode</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Cache</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">10000</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">expireTimeStamp</span> <span class="p">&lt;</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Second</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">delete</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">		<span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">10000</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">expireTimeStamp</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">expireDuration</span> <span class="o">+</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Second</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">head</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">right</span> <span class="p">=</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">val</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">listNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">key</span>             <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">val</span>             <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">left</span><span class="p">,</span> <span class="nx">right</span>     <span class="o">*</span><span class="nx">listNode</span>
</span></span><span class="line"><span class="cl">	<span class="nx">expireTimeStamp</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h2 id="百度-1">百度</h2>
<h3 id="20230824-百度一面">20230824 百度一面</h3>
<ul>
<li>
<p>聊项目，抠细节，30分钟</p>
</li>
<li>
<p>mysql的索引、事务</p>
</li>
<li>
<p>微服务治理手段，方法</p>
</li>
<li>
<p>连续子序列最大和</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">maxSum</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">s</span><span class="o">:=</span><span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="o">:=</span><span class="nx">s</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">=</span><span class="nf">max</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">max</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">a</span><span class="p">&lt;</span><span class="nx">b</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2023-07-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/interview/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://www.bardblog.cn/interview/" data-title="面试复盘" data-via="cz960601" data-hashtags="MySQL,InnoDB,Redis,Kafka,Algorithm"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://www.bardblog.cn/interview/" data-hashtag="MySQL"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://www.bardblog.cn/interview/" data-title="面试复盘"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://www.bardblog.cn/interview/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://www.bardblog.cn/interview/" data-title="面试复盘"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://www.bardblog.cn/interview/" data-title="面试复盘"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/mysql/">MySQL</a>,&nbsp;<a href="/tags/innodb/">InnoDB</a>,&nbsp;<a href="/tags/redis/">Redis</a>,&nbsp;<a href="/tags/kafka/">Kafka</a>,&nbsp;<a href="/tags/algorithm/">algorithm</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/git-advanced-usage/" class="prev" rel="prev" title="Git高级用法"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Git高级用法</a>
            <a href="/mysql-core-concepts/" class="next" rel="next" title="MySQL核心概念">MySQL核心概念<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.118.2">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://www.bardblog.cn" target="_blank">Bard</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{"gitalk":{"admin":["YourFantasy"],"clientID":"64f57a27c4b33d7930ff","clientSecret":"34e7c8aa13489f51aa54f53c4734d0e38762b83f","id":"2023-07-01T08:59:43+08:00","owner":"YourFantasy","repo":"blog","title":"面试复盘"}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"编程浪子","id-2":"编程浪子"},"lightgallery":true,"search":{"algoliaAppID":"58KPEJ4RD6","algoliaIndex":"index.zh-cn","algoliaSearchKey":"a48c9e27b67c52f03f9b8daa3cbdd18e","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
